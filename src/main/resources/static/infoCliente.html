<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info Cliente</title>
</head>
<body>

<h1>Información del Cliente</h1>

<script>
    const params = new URLSearchParams(window.location.search);
    const clienteId = params.get("clienteId");

    /* ---------- Título préstamos ---------- */
    const h2Prestamos = document.createElement("h2");
    h2Prestamos.textContent = "PRÉSTAMOS TERMINADOS";
    document.body.appendChild(h2Prestamos);

    const ulPrestamos = document.createElement("ul");
    document.body.appendChild(ulPrestamos);

    /* ---------- Info del cliente ---------- */
    fetch(`/clientes/${clienteId}`)
        .then(res => {
            if (!res.ok) throw new Error("Error al cargar cliente");
            return res.json();
        })
        .then(cliente => {
            const h3 = document.createElement("h3");
            h3.textContent = `Nombre: ${cliente.nombre} | Tel: ${cliente.telefono} | Dirección: ${cliente.direccion}`;
            document.body.insertBefore(h3, h2Prestamos);
        })
        .catch(err => console.error(err));

    /* ---------- Préstamos del cliente ---------- */
    fetch(`/prestamos/cliente/${clienteId}`)
        .then(res => {
            if (!res.ok) throw new Error("Error al cargar préstamos");
            return res.json();
        })
        .then(prestamos => {

            if (!Array.isArray(prestamos)) {
                console.error("Respuesta inesperada:", prestamos);
                return;
            }

            prestamos.forEach(prestamo => {
                // true = cerrado según tu backend
                if (prestamo.estado === true) {

                    const li = document.createElement("li");
                    li.innerHTML = `
                        <strong>Monto:</strong> ${prestamo.monto} <br>
                        <strong>Interés:</strong> ${prestamo.interes} <br>
                        <strong>Plazo:</strong> ${prestamo.plazo} <br>
                        <strong>Total a pagar:</strong> ${prestamo.totalAPagar} <br>
                        <strong>Fecha registro:</strong> ${prestamo.fechaRegistro} <br>
                        <strong>Fecha cierre:</strong> ${prestamo.fechaFinalizacion}
                    `;
                    ulPrestamos.appendChild(li);
                }
            });

            if (ulPrestamos.children.length === 0) {
                ulPrestamos.innerHTML = "<li>No hay préstamos terminados</li>";
            }
        })
        .catch(err => console.error(err));
</script>

</body>
</html>
